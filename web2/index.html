<!DOCTYPE html>
<html>

<head>
    <title>Countdown with Fireworks</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }

        #startButton {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            padding: 30px 60px;
            font-size: 40px;
            border: none;
            border-radius: 15px;
            background-color: red;
            color: white;
            cursor: pointer;
        }

        @media (max-width: 600px) {
            #startButton {
                padding: 15px 30px;
                font-size: 80px;
            }
        }
    </style>
</head>

<body>
    <canvas id="myCanvas" width="800" height="600"></canvas>
    <audio id="waitAudio" loop>
        <source src="wait.mp3" type="audio/mpeg">
    </audio>

    <audio id="hpnyAudio">
        <source src="hpny.mp3" type="audio/mpeg">
    </audio>

    <button id="startButton">Start</button>

    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        let WIDTH = canvas.width;
        let HEIGHT = canvas.height;

        // Màu sắc
        const PALETURQUOISE = 'rgb(175, 238, 238)';
        const BLACK = 'black';
        const WHITE = 'white';
        const LIGHT_RED = 'rgb(255, 150, 150)';
        const RED = 'red';
        const COLORS = [RED, 'green', 'blue', 'yellow', 'magenta', 'cyan'];

        // Lớp Particle (hạt pháo hoa)
        class Particle {
            constructor(x, y, angle, speed, color) {
                this.x = x;
                this.y = y;
                this.vx = speed * Math.cos(angle * Math.PI / 180);
                this.vy = -speed * Math.sin(angle * Math.PI / 180);
                this.color = color;
                this.lifetime = Math.random() * 70 + 50; // 50-120
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.lifetime--;
            }

            draw() {
                if (this.lifetime > 0) {
                    // Vẽ glow
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 6, 0, Math.PI * 2); // Vẽ hình tròn lớn hơn
                    ctx.fillStyle = this.color.replace(')', ', 0.2)'); // Thay đổi độ trong suốt (alpha) thành 0.2
                    ctx.fill();

                    // Vẽ hạt pháo hoa
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
            }
        }

        // Lớp Firework (pháo hoa)
        class Firework {
            constructor() {
                this.x = Math.random() * (WIDTH - 200) + 100;
                this.y = HEIGHT;
                this.targetY = Math.random() * (HEIGHT / 2 - 100) + 100;
                this.color = COLORS[Math.floor(Math.random() * COLORS.length)];
                this.particles = [];
                this.exploded = false;
                this.speed = 5;
            }

            update() {
                if (!this.exploded) {
                    this.y -= this.speed;
                    if (this.y <= this.targetY) {
                        this.exploded = true;
                        this.createParticles();
                    }
                } else {
                    this.particles.forEach(particle => particle.update());
                    this.particles = this.particles.filter(particle => particle.lifetime > 0);
                }
            }

            createParticles() {
                for (let i = 0; i < 360; i += 12) {
                    const speed = Math.random() * 3 + 2; // 2-5
                    this.particles.push(new Particle(this.x, this.y, i, speed, this.color));
                }
            }

            draw() {
                if (!this.exploded) {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 5, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                } else {
                    this.particles.forEach(particle => particle.draw());
                }
            }
        }

        // Hàm vẽ chữ với bóng đổ (đã được cập nhật)
        function drawTextWithShadow(text, x, y, font, color, shadowColor) {
            ctx.font = font;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle"; // Thêm thuộc tính này để căn giữa theo chiều dọc
            ctx.fillStyle = shadowColor;
            ctx.fillText(text, x + 4, y + 4);
            ctx.fillStyle = color;
            ctx.fillText(text, x, y);
        }

        // Lấy element audio
        const waitAudio = document.getElementById("waitAudio");
        const hpnyAudio = document.getElementById("hpnyAudio");

        // Hàm phát nhạc
        function playWaitAudio() {
            waitAudio.play();
        }

        function playHpnyAudio() {
            hpnyAudio.play();
        }

        // Hàm dừng nhạc
        function stopWaitAudio() {
            waitAudio.pause();
            waitAudio.currentTime = 0;
        }

    function showHappyNewYear() {
            stopWaitAudio();
            playHpnyAudio();
            ctx.clearRect(0, 0, WIDTH, HEIGHT);
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, WIDTH, HEIGHT);

            // Tính toán kích thước font chữ dựa trên chiều rộng màn hình
            let fontSize = WIDTH / 10; // Ví dụ: font chữ bằng 1/10 chiều rộng màn hình

            // Hiển thị chữ "Happy New Year!" với bóng đổ
            drawTextWithShadow('Happy New Year!', WIDTH / 2, HEIGHT / 2, fontSize + 'px Arial', WHITE, LIGHT_RED);

            const fireworks = []; // Khởi tạo mảng fireworks ở đây
            for (let i = 0; i < 5; i++) {
                fireworks.push(new Firework());
            }

            const endTime = new Date(Date.now() + 38 * 1000);
            // 38 seconds

            function animateFireworks() {
                ctx.clearRect(0, 0, WIDTH, HEIGHT);
                ctx.fillStyle = 'black'; // Đặt màu nền đen
                ctx.fillRect(0, 0, WIDTH, HEIGHT);

                // Hiển thị chữ "Happy New Year!" với bóng đổ, sử dụng lại fontSize đã tính toán
                drawTextWithShadow('Happy New Year!', WIDTH / 2, HEIGHT / 2, fontSize + 'px Arial', WHITE, LIGHT_RED);

                fireworks.forEach(firework => {
                    firework.update();
                    firework.draw();
                });
                if (Math.random() < 0.02) {
                    fireworks.push(new Firework());
                }

                // Remove fireworks that have exploded and have no particles left
                for (let i = fireworks.length - 1; i >= 0; i--) {
                    if (fireworks[i].exploded && fireworks[i].particles.length === 0) {
                        fireworks.splice(i, 1);
                    }
                }

                if (new Date() < endTime) {
                    requestAnimationFrame(animateFireworks);
                }
            }

            requestAnimationFrame(animateFireworks);
        }

        function countdownToTarget(targetTime) {
            function updateCountdown() {
                const now = new Date();
                const remainingSeconds = Math.max(0, Math.floor((targetTime - now) / 1000));

                if (remainingSeconds <= 0) {
                    showHappyNewYear();
                    return;
                }

                const hours = Math.floor(remainingSeconds / 3600);
                const minutes = Math.floor((remainingSeconds % 3600) / 60);
                const seconds = remainingSeconds % 60;

                ctx.clearRect(0, 0, WIDTH, HEIGHT);
                ctx.fillStyle = PALETURQUOISE;
                ctx.fillRect(0, 0, WIDTH, HEIGHT);

                // Hiển thị "Countdown" với bóng đổ
                drawTextWithShadow('Countdown', WIDTH / 2, HEIGHT / 4, '60px Arial', WHITE, BLACK);

                ctx.font = '80px Arial';
                ctx.fillStyle = RED;
                ctx.textAlign = 'center';
                ctx.fillText(`${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`, WIDTH / 2, HEIGHT / 2);

                requestAnimationFrame(updateCountdown);
            }

            updateCountdown();
        }

        // Set target time (you can customize this)
        function setTargetTime() {
            const now = new Date();
            const targetTime = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 0); // Tomorrow at midnight
            return targetTime;
        }

        // Thêm sự kiện click cho nút "Start"
        const startButton = document.getElementById("startButton");
        startButton.addEventListener("click", () => {
            playWaitAudio(); // Phát nhạc chờ
            startButton.style.display = "none"; // Ẩn nút "Start"
            const targetTime = setTargetTime();
            countdownToTarget(targetTime);
            resizeCanvas(); // Fullscreen canvas
        });

        // Fullscreen canvas
        // Hàm Fullscreen canvas (đã được cập nhật)
            function resizeCanvas() {
                WIDTH = window.innerWidth;
                HEIGHT = window.innerHeight;
                canvas.width = WIDTH;
                canvas.height = HEIGHT;

                // Cập nhật lại vị trí của pháo hoa khi thay đổi kích thước màn hình
                fireworks.forEach(firework => {
                    firework.x = Math.random() * (WIDTH - 200) + 100;
                    firework.y = HEIGHT;
                    firework.targetY = Math.random() * (HEIGHT / 2 - 100) + 100;
                });
            }
        window.addEventListener('resize', resizeCanvas);
    </script>

</body>

</html>